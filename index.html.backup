<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visor de Markdown</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #f5f5f5;
            --bg-secondary: white;
            --bg-tertiary: #fafafa;
            --text-primary: #333;
            --text-secondary: #6c757d;
            --header-bg: #2c3e50;
            --header-secondary: #34495e;
            --border-color: #eaecef;
            --code-bg: #f6f8fa;
            --table-header-bg: #f6f8fa;
            --link-color: #0366d6;
        }

        body.dark-mode {
            --bg-primary: #1a1a1a;
            --bg-secondary: #2d2d2d;
            --bg-tertiary: #252525;
            --text-primary: #e4e4e4;
            --text-secondary: #a0a0a0;
            --header-bg: #1a1a1a;
            --header-secondary: #2d2d2d;
            --border-color: #404040;
            --code-bg: #1e1e1e;
            --table-header-bg: #383838;
            --link-color: #58a6ff;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: var(--bg-primary);
            height: 100vh;
            overflow: hidden;
            transition: background 0.3s ease;
        }

        .header {
            background: var(--header-bg);
            color: white;
            padding: 1rem 2rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .header-left {
            flex: 1;
        }

        .header h1 {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .branding {
            font-size: 0.9rem;
            font-weight: 400;
            opacity: 0.8;
            font-family: 'Monaco', 'Courier New', monospace;
        }

        .branding a {
            color: #3498db;
            text-decoration: none;
            transition: opacity 0.3s;
        }

        .branding a:hover {
            opacity: 0.8;
            text-decoration: underline;
        }

        .footer {
            background: var(--header-bg);
            color: white;
            padding: 0.5rem 2rem;
            text-align: center;
            font-size: 0.85rem;
            opacity: 0.9;
        }

        .footer a {
            color: #3498db;
            text-decoration: none;
        }

        .footer a:hover {
            text-decoration: underline;
        }

        .header-actions {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .btn {
            padding: 0.5rem 1rem;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.3s;
            font-size: 0.9rem;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn:hover {
            background: #2980b9;
        }

        .btn-secondary {
            background: #95a5a6;
        }

        .btn-secondary:hover {
            background: #7f8c8d;
        }

        .btn-success {
            background: #27ae60;
        }

        .btn-success:hover {
            background: #229954;
        }

        .file-input-container {
            margin-top: 0.5rem;
        }

        .file-input-container input[type="file"] {
            display: none;
        }

        .file-label {
            display: inline-block;
            padding: 0.5rem 1rem;
            background: #3498db;
            color: white;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .file-label:hover {
            background: #2980b9;
        }

        .file-name {
            margin-left: 1rem;
            color: #ecf0f1;
            font-size: 0.9rem;
        }

        .container {
            display: flex;
            height: calc(100vh - 130px);
            padding: 0;
            position: relative;
        }

        .column {
            overflow-y: auto;
            background: var(--bg-secondary);
            flex-shrink: 0;
        }

        .column:first-child {
            width: 50%;
            min-width: 200px;
        }

        .column:last-child {
            flex: 1;
            min-width: 200px;
        }

        .resizer {
            width: 5px;
            background: var(--border-color);
            cursor: col-resize;
            position: relative;
            flex-shrink: 0;
            transition: background 0.2s;
        }

        .resizer:hover {
            background: #3498db;
        }

        .resizer.resizing {
            background: #3498db;
        }

        .resizer::before {
            content: '';
            position: absolute;
            top: 0;
            left: -2px;
            right: -2px;
            bottom: 0;
        }

        .column-header {
            background: var(--header-secondary);
            color: white;
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .markdown-input {
            width: 100%;
            height: calc(100% - 45px);
            padding: 1.5rem;
            border: none;
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.6;
            resize: none;
            background: var(--bg-tertiary);
            color: var(--text-primary);
            transition: background 0.3s ease, color 0.3s ease;
        }

        .markdown-input:focus {
            outline: none;
            background: var(--bg-secondary);
        }

        .markdown-preview {
            padding: 1.5rem 2rem;
            min-height: calc(100% - 45px);
            color: var(--text-primary);
            transition: color 0.3s ease;
        }

        /* Estilos para el markdown renderizado */
        .markdown-preview h1 {
            font-size: 2em;
            margin-top: 1em;
            margin-bottom: 0.5em;
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 0.3em;
        }

        .markdown-preview h2 {
            font-size: 1.5em;
            margin-top: 1em;
            margin-bottom: 0.5em;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 0.3em;
        }

        .markdown-preview h3 {
            font-size: 1.25em;
            margin-top: 1em;
            margin-bottom: 0.5em;
        }

        .markdown-preview h4, .markdown-preview h5, .markdown-preview h6 {
            margin-top: 1em;
            margin-bottom: 0.5em;
        }

        .markdown-preview p {
            margin-bottom: 1em;
            line-height: 1.7;
        }

        .markdown-preview code {
            background: var(--code-bg);
            padding: 0.2em 0.4em;
            border-radius: 3px;
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 0.9em;
            color: var(--text-primary);
        }

        .markdown-preview pre {
            background: var(--code-bg);
            padding: 1em;
            border-radius: 6px;
            overflow-x: auto;
            margin-bottom: 1em;
        }

        .markdown-preview pre code {
            background: none;
            padding: 0;
        }

        .markdown-preview blockquote {
            border-left: 4px solid var(--border-color);
            padding-left: 1em;
            margin-left: 0;
            margin-bottom: 1em;
            color: var(--text-secondary);
        }

        .markdown-preview ul, .markdown-preview ol {
            margin-bottom: 1em;
            padding-left: 2em;
        }

        .markdown-preview li {
            margin-bottom: 0.25em;
            line-height: 1.7;
        }

        .markdown-preview table {
            border-collapse: collapse;
            width: 100%;
            margin-bottom: 1em;
        }

        .markdown-preview table th,
        .markdown-preview table td {
            border: 1px solid var(--border-color);
            padding: 0.6em 1em;
            text-align: left;
        }

        .markdown-preview table th {
            background: var(--table-header-bg);
            font-weight: 600;
        }

        .markdown-preview a {
            color: var(--link-color);
            text-decoration: none;
        }

        .markdown-preview a:hover {
            text-decoration: underline;
        }

        .markdown-preview img {
            max-width: 100%;
            height: auto;
        }

        .markdown-preview hr {
            border: none;
            border-top: 2px solid var(--border-color);
            margin: 1.5em 0;
        }

        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: var(--text-secondary);
            text-align: center;
            padding: 2rem;
        }

        .empty-state svg {
            width: 80px;
            height: 80px;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        /* Estilos para modo impresión/PDF */
        @media print {
            .header, .footer, .markdown-input, .column:first-child, .resizer {
                display: none !important;
            }

            .container {
                display: block;
                height: auto;
            }

            .column {
                overflow: visible;
            }

            .markdown-preview {
                padding: 0;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-left">
            <h1>
                Visor de Markdown
                <span class="branding">by <a href="https://ablancodev.com" target="_blank" rel="noopener">&gt;_ablancodev</a></span>
            </h1>
            <div class="file-input-container">
                <label for="fileInput" class="file-label">
                    Seleccionar archivo .md
                </label>
                <input type="file" id="fileInput" accept=".md,.markdown,.txt">
                <span class="file-name" id="fileName"></span>
            </div>
        </div>
        <div class="header-actions">
            <button class="btn btn-secondary" id="darkModeToggle">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                    <path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"/>
                </svg>
                <span id="modeText">Modo Oscuro</span>
            </button>
            <button class="btn btn-success" id="exportPdfBtn">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                    <path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z"/>
                    <path d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3z"/>
                </svg>
                Exportar PDF
            </button>
        </div>
    </div>

    <div class="container">
        <div class="column" id="leftColumn">
            <div class="column-header">Markdown</div>
            <textarea class="markdown-input" id="markdownInput" placeholder="El contenido del archivo .md se mostrará aquí..."></textarea>
        </div>
        <div class="resizer" id="resizer"></div>
        <div class="column" id="rightColumn">
            <div class="column-header">Vista Previa</div>
            <div class="markdown-preview" id="markdownPreview">
                <div class="empty-state">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                    </svg>
                    <h3>Carga un archivo markdown para comenzar</h3>
                    <p>Haz clic en "Seleccionar archivo .md" para subir tu documento</p>
                </div>
            </div>
        </div>
    </div>

    <div class="footer">
        Desarrollado por <a href="https://ablancodev.com" target="_blank" rel="noopener">&gt;_ablancodev</a> | Visor de Markdown v1.0
    </div>

    <script>
        const fileInput = document.getElementById('fileInput');
        const fileName = document.getElementById('fileName');
        const markdownInput = document.getElementById('markdownInput');
        const markdownPreview = document.getElementById('markdownPreview');

        // Manejar selección de archivo
        fileInput.addEventListener('change', function(e) {
            const file = e.target.files[0];

            if (file) {
                fileName.textContent = file.name;

                const reader = new FileReader();
                reader.onload = function(event) {
                    const content = event.target.result;
                    markdownInput.value = content;
                    renderMarkdown(content);
                };
                reader.readAsText(file);
            }
        });

        // Actualizar vista previa cuando se edita el texto
        markdownInput.addEventListener('input', function() {
            renderMarkdown(this.value);
        });

        // Función para renderizar el markdown
        function renderMarkdown(text) {
            if (text.trim() === '') {
                markdownPreview.innerHTML = `
                    <div class="empty-state">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                        </svg>
                        <h3>Carga un archivo markdown para comenzar</h3>
                        <p>Haz clic en "Seleccionar archivo .md" para subir tu documento</p>
                    </div>
                `;
            } else {
                markdownPreview.innerHTML = marked.parse(text);
            }
        }

        // Sincronizar scroll (opcional)
        let isScrollingLeft = false;
        let isScrollingRight = false;

        markdownInput.addEventListener('scroll', function() {
            if (!isScrollingRight) {
                isScrollingLeft = true;
                const scrollPercent = this.scrollTop / (this.scrollHeight - this.clientHeight);
                const preview = markdownPreview.parentElement;
                preview.scrollTop = scrollPercent * (preview.scrollHeight - preview.clientHeight);
                setTimeout(() => isScrollingLeft = false, 100);
            }
        });

        markdownPreview.parentElement.addEventListener('scroll', function() {
            if (!isScrollingLeft) {
                isScrollingRight = true;
                const scrollPercent = this.scrollTop / (this.scrollHeight - this.clientHeight);
                markdownInput.scrollTop = scrollPercent * (markdownInput.scrollHeight - markdownInput.clientHeight);
                setTimeout(() => isScrollingRight = false, 100);
            }
        });

        // Dark Mode Toggle
        const darkModeToggle = document.getElementById('darkModeToggle');
        const modeText = document.getElementById('modeText');
        const sunIcon = `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
            <path d="M8 11a3 3 0 1 1 0-6 3 3 0 0 1 0 6zm0 1a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"/>
        </svg>`;
        const moonIcon = `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
            <path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"/>
        </svg>`;

        // Cargar preferencia guardada
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'dark') {
            document.body.classList.add('dark-mode');
            darkModeToggle.innerHTML = sunIcon + '<span id="modeText">Modo Claro</span>';
        }

        darkModeToggle.addEventListener('click', function() {
            document.body.classList.toggle('dark-mode');

            if (document.body.classList.contains('dark-mode')) {
                darkModeToggle.innerHTML = sunIcon + '<span id="modeText">Modo Claro</span>';
                localStorage.setItem('theme', 'dark');
            } else {
                darkModeToggle.innerHTML = moonIcon + '<span id="modeText">Modo Oscuro</span>';
                localStorage.setItem('theme', 'light');
            }
        });

        // Redimensionar columnas
        const resizer = document.getElementById('resizer');
        const leftColumn = document.getElementById('leftColumn');
        const rightColumn = document.getElementById('rightColumn');
        const container = document.querySelector('.container');

        // Cargar ancho guardado
        const savedWidth = localStorage.getItem('leftColumnWidth');
        if (savedWidth) {
            leftColumn.style.width = savedWidth;
        }

        let isResizing = false;

        resizer.addEventListener('mousedown', function(e) {
            isResizing = true;
            resizer.classList.add('resizing');
            document.body.style.cursor = 'col-resize';
            document.body.style.userSelect = 'none';
        });

        document.addEventListener('mousemove', function(e) {
            if (!isResizing) return;

            const containerRect = container.getBoundingClientRect();
            const newWidth = e.clientX - containerRect.left;
            const containerWidth = containerRect.width;

            // Limitar el ancho mínimo y máximo
            const minWidth = 200;
            const maxWidth = containerWidth - 200 - 5; // 5px para el resizer

            if (newWidth >= minWidth && newWidth <= maxWidth) {
                const percentage = (newWidth / containerWidth) * 100;
                leftColumn.style.width = percentage + '%';
            }
        });

        document.addEventListener('mouseup', function() {
            if (isResizing) {
                isResizing = false;
                resizer.classList.remove('resizing');
                document.body.style.cursor = '';
                document.body.style.userSelect = '';

                // Guardar el ancho
                localStorage.setItem('leftColumnWidth', leftColumn.style.width);
            }
        });

        // Exportar a PDF
        const exportPdfBtn = document.getElementById('exportPdfBtn');

        exportPdfBtn.addEventListener('click', function() {
            const content = markdownInput.value;

            if (content.trim() === '') {
                alert('No hay contenido para exportar. Por favor, carga un archivo markdown primero.');
                return;
            }

            // Crear un elemento temporal con el contenido renderizado
            const element = document.createElement('div');
            element.innerHTML = marked.parse(content);
            element.style.padding = '20px';
            element.style.fontFamily = '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
            element.style.lineHeight = '1.6';
            element.style.color = '#000';
            element.style.backgroundColor = '#fff';

            // Agregar footer con branding
            const footer = document.createElement('div');
            footer.style.marginTop = '3em';
            footer.style.paddingTop = '1em';
            footer.style.borderTop = '1px solid #ddd';
            footer.style.fontSize = '0.8em';
            footer.style.color = '#666';
            footer.style.textAlign = 'center';
            footer.innerHTML = 'Generado con Visor de Markdown | >_ablancodev | https://ablancodev.com';
            element.appendChild(footer);

            // Aplicar estilos para el PDF
            const style = document.createElement('style');
            style.textContent = `
                h1 { font-size: 2em; margin-top: 1em; margin-bottom: 0.5em; border-bottom: 2px solid #eaecef; padding-bottom: 0.3em; }
                h2 { font-size: 1.5em; margin-top: 1em; margin-bottom: 0.5em; border-bottom: 1px solid #eaecef; padding-bottom: 0.3em; }
                h3 { font-size: 1.25em; margin-top: 1em; margin-bottom: 0.5em; }
                p { margin-bottom: 1em; line-height: 1.7; }
                code { background: #f6f8fa; padding: 0.2em 0.4em; border-radius: 3px; font-family: monospace; font-size: 0.9em; }
                pre { background: #f6f8fa; padding: 1em; border-radius: 6px; overflow-x: auto; margin-bottom: 1em; }
                pre code { background: none; padding: 0; }
                blockquote { border-left: 4px solid #dfe2e5; padding-left: 1em; margin-left: 0; margin-bottom: 1em; color: #6a737d; }
                ul, ol { margin-bottom: 1em; padding-left: 2em; }
                li { margin-bottom: 0.25em; line-height: 1.7; }
                table { border-collapse: collapse; width: 100%; margin-bottom: 1em; }
                table th, table td { border: 1px solid #dfe2e5; padding: 0.6em 1em; text-align: left; }
                table th { background: #f6f8fa; font-weight: 600; }
                a { color: #0366d6; text-decoration: none; }
                img { max-width: 100%; height: auto; }
                hr { border: none; border-top: 2px solid #eaecef; margin: 1.5em 0; }
            `;
            element.appendChild(style);

            // Configuración para html2pdf
            // Obtener el nombre del archivo y asegurar extensión .pdf
            let pdfFilename = 'documento.pdf';
            if (fileName.textContent) {
                pdfFilename = fileName.textContent.replace(/\.(md|markdown|txt)$/i, '') + '.pdf';
            }

            const opt = {
                margin: 1,
                filename: pdfFilename,
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2 },
                jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' }
            };

            // Generar PDF
            html2pdf().set(opt).from(element).save();
        });
    </script>
</body>
</html>
